{
    "version": 3,
    "file": "Service.js",
    "sourceRoot": "",
    "sources": [
        "/src/renderers/Service.tsx"
    ],
    "names": [],
    "mappings": "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",
    "sourcesContent": [
        "import React from 'react';\nimport PropTypes from 'prop-types';\nimport {Renderer, RendererProps} from '../factory';\nimport {ServiceStore, IServiceStore} from '../store/service';\nimport {Api, SchemaNode, ApiObject, RendererData, Action} from '../types';\nimport {filter, evalExpression} from '../utils/tpl';\nimport cx from 'classnames';\nimport Scoped, {ScopedContext, IScopedContext} from '../Scoped';\nimport {observer} from 'mobx-react';\nimport {isApiOutdated, isEffectiveApi} from '../utils/api';\nimport {Spinner} from '../components';\nimport {autobind, isVisible} from '../utils/helper';\nimport {\n  BaseSchema,\n  SchemaApi,\n  SchemaCollection,\n  SchemaExpression,\n  SchemaMessage,\n  SchemaName\n} from '../Schema';\n\n/**\n * Service 服务类控件。\n * 文档：https://baidu.gitee.io/amis/docs/components/service\n */\nexport interface ServiceSchema extends BaseSchema {\n  /**\n   * 指定为 Service 数据拉取控件。\n   */\n  type: 'service';\n\n  /**\n   * 页面初始化的时候，可以设置一个 API 让其取拉取，发送数据会携带当前 data 数据（包含地址栏参数），获取得数据会合并到 data 中，供组件内使用。\n   */\n  api?: SchemaApi;\n\n  /**\n   * 内容区域\n   */\n  body?: SchemaCollection;\n\n  /**\n   * @deprecated 改成 api 的 sendOn。\n   */\n  fetchOn?: SchemaExpression;\n\n  /**\n   * 是否默认就拉取？\n   */\n  initFetch?: boolean;\n\n  /**\n   * 是否默认就拉取？通过表达式来决定.\n   *\n   * @deprecated 改成 api 的 sendOn。\n   */\n  initFetchOn?: SchemaExpression;\n\n  /**\n   * 用来获取远程 Schema 的 api\n   */\n  schemaApi?: SchemaApi;\n\n  /**\n   * 是否默认加载 schemaApi\n   */\n  initFetchSchema?: boolean;\n\n  /**\n   * 用表达式来配置。\n   * @deprecated 改成 api 的 sendOn。\n   */\n  initFetchSchemaOn?: SchemaExpression;\n\n  /**\n   * 是否轮询拉取\n   */\n  interval?: number;\n\n  /**\n   * 是否静默拉取\n   */\n  silentPolling?: boolean;\n\n  /**\n   * 关闭轮询的条件。\n   */\n  stopAutoRefreshWhen?: SchemaExpression;\n\n  messages?: SchemaMessage;\n\n  name?: SchemaName;\n}\n\nexport interface ServiceProps extends RendererProps, ServiceSchema {\n  store: IServiceStore;\n  messages: SchemaMessage;\n}\nexport default class Service extends React.Component<ServiceProps> {\n  timer: NodeJS.Timeout;\n  mounted: boolean;\n\n  static defaultProps: Partial<ServiceProps> = {\n    messages: {\n      fetchFailed: '初始化失败'\n    }\n  };\n\n  static propsList: Array<string> = [];\n\n  constructor(props: ServiceProps) {\n    super(props);\n\n    this.handleQuery = this.handleQuery.bind(this);\n    this.handleAction = this.handleAction.bind(this);\n    this.reload = this.reload.bind(this);\n    this.silentReload = this.silentReload.bind(this);\n    this.initInterval = this.initInterval.bind(this);\n    this.afterDataFetch = this.afterDataFetch.bind(this);\n    this.afterSchemaFetch = this.afterSchemaFetch.bind(this);\n  }\n\n  componentDidMount() {\n    this.mounted = true;\n    this.initFetch();\n  }\n\n  componentDidUpdate(prevProps: ServiceProps) {\n    const props = this.props;\n    const store = props.store;\n\n    const {fetchSuccess, fetchFailed} = props.messages!;\n\n    isApiOutdated(prevProps.api, props.api, prevProps.data, props.data) &&\n      store\n        .fetchData(props.api as Api, store.data, {\n          successMessage: fetchSuccess,\n          errorMessage: fetchFailed\n        })\n        .then(this.afterDataFetch);\n\n    isApiOutdated(\n      prevProps.schemaApi,\n      props.schemaApi,\n      prevProps.data,\n      props.data\n    ) &&\n      store\n        .fetchSchema(props.schemaApi as Api, store.data, {\n          successMessage: fetchSuccess,\n          errorMessage: fetchFailed\n        })\n        .then(this.afterSchemaFetch);\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n    clearTimeout(this.timer);\n  }\n\n  @autobind\n  initFetch() {\n    const {\n      schemaApi,\n      initFetchSchema,\n      api,\n      initFetch,\n      initFetchOn,\n      store,\n      messages: {fetchSuccess, fetchFailed}\n    } = this.props;\n\n    if (isEffectiveApi(schemaApi, store.data, initFetchSchema)) {\n      store\n        .fetchSchema(schemaApi, store.data, {\n          successMessage: fetchSuccess,\n          errorMessage: fetchFailed\n        })\n        .then(this.afterSchemaFetch);\n    }\n\n    if (isEffectiveApi(api, store.data, initFetch, initFetchOn)) {\n      store\n        .fetchInitData(api, store.data, {\n          successMessage: fetchSuccess,\n          errorMessage: fetchFailed\n        })\n        .then(this.afterDataFetch);\n    }\n  }\n\n  afterDataFetch(data: any) {\n    this.initInterval(data);\n  }\n\n  afterSchemaFetch(schema: any) {\n    this.initInterval(schema);\n  }\n\n  initInterval(value: any) {\n    const {interval, silentPolling, stopAutoRefreshWhen, data} = this.props;\n\n    clearTimeout(this.timer);\n\n    interval &&\n      this.mounted &&\n      (!stopAutoRefreshWhen || !evalExpression(stopAutoRefreshWhen, data)) &&\n      (this.timer = setTimeout(\n        silentPolling ? this.silentReload : this.reload,\n        Math.max(interval, 3000)\n      ));\n    return value;\n  }\n\n  reload(subpath?: string, query?: any, ctx?: RendererData, silent?: boolean) {\n    if (query) {\n      return this.receive(query);\n    }\n\n    const {\n      schemaApi,\n      initFetchSchema,\n      api,\n      initFetch,\n      initFetchOn,\n      store,\n      messages: {fetchSuccess, fetchFailed}\n    } = this.props;\n\n    clearTimeout(this.timer);\n\n    if (isEffectiveApi(schemaApi, store.data)) {\n      store\n        .fetchSchema(schemaApi, store.data, {\n          successMessage: fetchSuccess,\n          errorMessage: fetchFailed\n        })\n        .then(this.afterSchemaFetch);\n    }\n\n    if (isEffectiveApi(api, store.data)) {\n      store\n        .fetchData(api, store.data, {\n          silent,\n          successMessage: fetchSuccess,\n          errorMessage: fetchFailed\n        })\n        .then(this.afterDataFetch);\n    }\n  }\n\n  silentReload(target?: string, query?: any) {\n    this.reload(target, query, undefined, true);\n  }\n\n  receive(values: object) {\n    const {store} = this.props;\n\n    store.updateData(values);\n    this.reload();\n  }\n\n  handleQuery(query: any) {\n    if (this.props.api || this.props.schemaApi) {\n      this.receive(query);\n    } else {\n      this.props.onQuery?.(query);\n    }\n  }\n\n  reloadTarget(target: string, data?: any) {\n    // 会被覆写\n  }\n\n  openFeedback(dialog: any, ctx: any) {\n    return new Promise(resolve => {\n      const {store} = this.props;\n      const parentStore = store.parentStore;\n\n      // 暂时自己不支持弹出 dialog\n      if (parentStore && parentStore.openDialog) {\n        store.setCurrentAction({\n          type: 'button',\n          actionType: 'dialog',\n          dialog: dialog\n        });\n        store.openDialog(ctx, undefined, confirmed => {\n          resolve(confirmed);\n        });\n      }\n    });\n  }\n\n  handleAction(\n    e: React.UIEvent<any> | void,\n    action: Action,\n    data: object,\n    throwErrors: boolean = false,\n    delegate?: IScopedContext\n  ) {\n    const {onAction, store, env, api, translate: __} = this.props;\n\n    if (api && action.actionType === 'ajax') {\n      store.setCurrentAction(action);\n      store\n        .saveRemote(action.api as string, data, {\n          successMessage: __(action.messages && action.messages.success),\n          errorMessage: __(action.messages && action.messages.failed)\n        })\n        .then(async (payload: any) => {\n          this.afterDataFetch(payload);\n\n          if (action.feedback && isVisible(action.feedback, store.data)) {\n            await this.openFeedback(action.feedback, store.data);\n          }\n\n          const redirect =\n            action.redirect && filter(action.redirect, store.data);\n          redirect && env.jumpTo(redirect, action);\n          action.reload && this.reloadTarget(action.reload, store.data);\n        })\n        .catch(() => {});\n    } else {\n      onAction(e, action, data, throwErrors, delegate || this.context);\n    }\n  }\n\n  renderBody() {\n    const {render, store, body: schema, classnames: cx} = this.props;\n\n    return (\n      <div className={cx('Service-body')}>\n        {\n          render('body', store.schema || schema, {\n            key: store.schemaKey || 'body',\n            onQuery: this.handleQuery,\n            onAction: this.handleAction\n          }) as JSX.Element\n        }\n      </div>\n    );\n  }\n\n  render() {\n    const {\n      className,\n      store,\n      render,\n      classPrefix: ns,\n      classnames: cx\n    } = this.props;\n\n    return (\n      <div className={cx(`${ns}Service`, className)}>\n        {store.error ? (\n          <div className={cx(`Alert Alert--danger`)}>\n            <button\n              className={cx('Alert-close')}\n              onClick={() => store.updateMessage('')}\n              type=\"button\"\n            >\n              <span>×</span>\n            </button>\n            {store.msg}\n          </div>\n        ) : null}\n\n        {this.renderBody()}\n\n        <Spinner size=\"lg\" overlay key=\"info\" show={store.loading} />\n      </div>\n    );\n  }\n}\n\n@Renderer({\n  test: /(^|\\/)service$/,\n  storeType: ServiceStore.name,\n  name: 'service'\n})\nexport class ServiceRenderer extends Service {\n  static contextType = ScopedContext;\n\n  componentWillMount() {\n    // super.componentWillMount();\n    const scoped = this.context as IScopedContext;\n    scoped.registerComponent(this);\n  }\n\n  componentWillUnmount() {\n    super.componentWillUnmount();\n    const scoped = this.context as IScopedContext;\n    scoped.unRegisterComponent(this);\n  }\n\n  reloadTarget(target: string, data?: any) {\n    const scoped = this.context as IScopedContext;\n    scoped.reload(target, data);\n  }\n}\n"
    ]
}