{
    "version": 3,
    "file": "ChainedSelect.js",
    "sourceRoot": "",
    "sources": [
        "/src/renderers/Form/ChainedSelect.tsx"
    ],
    "names": [],
    "mappings": "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",
    "sourcesContent": [
        "import React from 'react';\nimport cx from 'classnames';\nimport {\n  OptionsControl,\n  OptionsControlProps,\n  Option,\n  FormOptionsControl\n} from './Options';\nimport Select from '../../components/Select';\nimport {Api} from '../../types';\nimport {isEffectiveApi} from '../../utils/api';\nimport {SchemaApi} from '../../Schema';\n\n/**\n * 级联选择框\n * 文档：https://baidu.gitee.io/amis/docs/components/form/chained-select\n */\nexport interface ChainedSelectControlSchema extends FormOptionsControl {\n  type: 'chained-select';\n}\n\nexport interface ChainedSelectProps\n  extends OptionsControlProps,\n    Omit<ChainedSelectControlSchema, 'options' | 'source'> {}\n\nexport interface SelectState {\n  stack: Array<{\n    options: Array<Option>;\n    parentId: any;\n    loading: boolean;\n    visible?: boolean;\n  }>;\n}\n\nexport default class ChainedSelectControl extends React.Component<\n  ChainedSelectProps,\n  SelectState\n> {\n  static defaultProps: Partial<ChainedSelectProps> = {\n    clearable: false,\n    searchable: false,\n    multiple: true\n  };\n\n  state: SelectState = {\n    stack: []\n  };\n  constructor(props: ChainedSelectProps) {\n    super(props);\n\n    this.handleChange = this.handleChange.bind(this);\n    this.loadMore = this.loadMore.bind(this);\n  }\n\n  componentDidMount() {\n    const {formInited} = this.props;\n\n    formInited ? this.loadMore() : this.props.addHook(this.loadMore, 'init');\n  }\n\n  componentWillReceiveProps(nextProps: ChainedSelectProps) {\n    const props = this.props;\n\n    if (props.options !== nextProps.options) {\n      this.setState({\n        stack: []\n      });\n    }\n  }\n\n  componentDidUpdate(prevProps: ChainedSelectProps) {\n    const props = this.props;\n\n    if (props.formInited && props.value !== prevProps.value) {\n      this.loadMore();\n    }\n  }\n\n  loadMore() {\n    const {\n      value,\n      delimiter,\n      onChange,\n      joinValues,\n      extractValue,\n      source,\n      data,\n      env\n    } = this.props;\n\n    const arr = Array.isArray(value)\n      ? value.concat()\n      : value && typeof value === 'string'\n      ? value.split(delimiter || ',')\n      : [];\n    let idx = 0;\n    let len = this.state.stack.length;\n    while (\n      idx < len &&\n      arr[idx] &&\n      this.state.stack[idx].parentId ==\n        (joinValues || extractValue ? arr[idx] : arr[idx].value)\n    ) {\n      idx++;\n    }\n\n    if (!arr[idx] || !env || !isEffectiveApi(source, data)) {\n      return;\n    }\n\n    const parentId = joinValues || extractValue ? arr[idx] : arr[idx].value;\n    const stack = this.state.stack.concat();\n    stack.splice(idx, stack.length - idx);\n    stack.push({\n      parentId,\n      loading: true,\n      options: []\n    });\n\n    this.setState(\n      {\n        stack\n      },\n      () => {\n        env\n          .fetcher(source as Api, {\n            ...data,\n            value: arr,\n            level: idx + 1,\n            parentId,\n            parent: arr[idx]\n          })\n          .then(ret => {\n            // todo 没有检测 response.ok\n\n            const stack = this.state.stack.concat();\n            const remoteValue = ret.data ? ret.data.value : undefined;\n            let options = (ret.data && (ret.data as any).options) || ret.data;\n\n            stack.splice(idx, stack.length - idx);\n\n            if (typeof remoteValue !== 'undefined') {\n              arr.splice(idx + 1, value.length - idx - 1);\n              arr.push(remoteValue);\n              onChange(joinValues ? arr.join(delimiter || ',') : arr);\n            }\n\n            stack.push({\n              options,\n              parentId,\n              loading: false,\n              visible: !!options\n            });\n\n            this.setState(\n              {\n                stack: stack\n              },\n              this.loadMore\n            );\n          })\n          .catch(e => {\n            env.notify('error', e.message);\n          });\n      }\n    );\n  }\n\n  handleChange(index: number, currentValue: any) {\n    const {value, delimiter, onChange, joinValues, extractValue} = this.props;\n\n    const arr = Array.isArray(value)\n      ? value.concat()\n      : value && typeof value === 'string'\n      ? value.split(delimiter || ',')\n      : [];\n    arr.splice(index, arr.length - index);\n    arr.push(joinValues ? currentValue.value : currentValue);\n\n    onChange(\n      joinValues\n        ? arr.join(delimiter || ',')\n        : extractValue\n        ? arr.map(item => item.value || item)\n        : arr\n    );\n  }\n\n  reload() {\n    const reload = this.props.reloadOptions;\n    reload && reload();\n  }\n\n  render() {\n    const {\n      options,\n      classPrefix: ns,\n      className,\n      inline,\n      loading,\n      value,\n      delimiter,\n      joinValues,\n      extractValue,\n      multiple,\n      ...rest\n    } = this.props;\n    const arr = Array.isArray(value)\n      ? value.concat()\n      : value && typeof value === 'string'\n      ? value.split(delimiter || ',')\n      : [];\n\n    return (\n      <div className={cx(`${ns}ChainedSelectControl`, className)}>\n        <Select\n          {...rest}\n          classPrefix={ns}\n          key=\"base\"\n          options={options}\n          value={arr[0]}\n          onChange={this.handleChange.bind(this, 0)}\n          loading={loading}\n          inline\n        />\n\n        {this.state.stack.map(({options, loading, visible}, index) =>\n          visible === false ? null : (\n            <Select\n              {...rest}\n              classPrefix={ns}\n              key={`x-${index + 1}`}\n              options={options}\n              value={arr[index + 1]}\n              onChange={this.handleChange.bind(this, index + 1)}\n              loading={loading}\n              inline\n            />\n          )\n        )}\n      </div>\n    );\n  }\n}\n\n@OptionsControl({\n  type: 'chained-select',\n  sizeMutable: false\n})\nexport class ChainedSelectControlRenderer extends ChainedSelectControl {}\n"
    ]
}