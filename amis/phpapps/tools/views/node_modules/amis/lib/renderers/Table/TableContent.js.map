{
    "version": 3,
    "file": "TableContent.js",
    "sourceRoot": "",
    "sources": [
        "/src/renderers/Table/TableContent.tsx"
    ],
    "names": [],
    "mappings": "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",
    "sourcesContent": [
        "import React from 'react';\nimport {ClassNamesFn} from '../../theme';\nimport {IColumn, IRow} from '../../store/table';\nimport {SchemaNode, Action} from '../../types';\nimport {TableRow} from './TableRow';\nimport {filter} from '../../utils/tpl';\nimport {observer} from 'mobx-react';\nimport {trace, reaction} from 'mobx';\nimport {flattenTree} from '../../utils/helper';\n\nexport interface TableContentProps {\n  className?: string;\n  tableClassName?: string;\n  classnames: ClassNamesFn;\n  columns: Array<IColumn>;\n  columnsGroup: Array<{\n    label: string;\n    index: number;\n    colSpan: number;\n    has: Array<any>;\n  }>;\n  rows: Array<IRow>;\n  placeholder?: string;\n  render: (region: string, node: SchemaNode, props?: any) => JSX.Element;\n  onMouseMove: (event: React.MouseEvent) => void;\n  onScroll: (event: React.UIEvent) => void;\n  tableRef: (table?: HTMLTableElement | null) => void;\n  renderHeadCell: (column: IColumn, props?: any) => JSX.Element;\n  renderCell: (\n    region: string,\n    column: IColumn,\n    item: IRow,\n    props: any\n  ) => React.ReactNode;\n  onCheck: (item: IRow) => void;\n  onQuickChange?: (\n    item: IRow,\n    values: object,\n    saveImmediately?: boolean | any,\n    savePristine?: boolean\n  ) => void;\n  footable?: boolean;\n  footableColumns: Array<IColumn>;\n  checkOnItemClick?: boolean;\n  buildItemProps?: (item: IRow, index: number) => any;\n  onAction?: (e: React.UIEvent<any>, action: Action, ctx: object) => void;\n  rowClassNameExpr?: string;\n  rowClassName?: string;\n}\n\nexport class TableContent extends React.Component<TableContentProps> {\n  reaction?: () => void;\n  constructor(props: TableContentProps) {\n    super(props);\n\n    const rows = props.rows;\n\n    this.reaction = reaction(\n      () =>\n        `${flattenTree(rows)\n          .map(item => `${item.id}`)\n          .join(',')}${rows\n          .filter(item => item.checked)\n          .map(item => item.id)\n          .join(',')}`,\n      () => this.forceUpdate(),\n      {\n        onError: () => this.reaction!()\n      }\n    );\n  }\n\n  shouldComponentUpdate(nextProps: TableContentProps) {\n    const props = this.props;\n\n    if (\n      props.columns !== nextProps.columns ||\n      props.buildItemProps !== nextProps.buildItemProps\n    ) {\n      return true;\n    }\n\n    return false;\n  }\n\n  componentwillUnmount() {\n    this.reaction?.();\n  }\n\n  renderRows(\n    rows: Array<any>,\n    columns = this.props.columns,\n    rowProps: any = {}\n  ): any {\n    const {\n      rowClassName,\n      rowClassNameExpr,\n      onAction,\n      buildItemProps,\n      checkOnItemClick,\n      classnames: cx,\n      render,\n      renderCell,\n      onCheck,\n      onQuickChange,\n      footable,\n      footableColumns\n    } = this.props;\n\n    return rows.map((item: IRow, rowIndex: number) => {\n      const itemProps = buildItemProps ? buildItemProps(item, rowIndex) : null;\n\n      const doms = [\n        <TableRow\n          {...itemProps}\n          classnames={cx}\n          checkOnItemClick={checkOnItemClick}\n          key={item.id}\n          itemIndex={rowIndex}\n          item={item}\n          itemClassName={cx(\n            rowClassNameExpr\n              ? filter(rowClassNameExpr, item.data)\n              : rowClassName,\n            {\n              'is-last': item.depth > 1 && rowIndex === rows.length - 1\n            }\n          )}\n          columns={columns}\n          renderCell={renderCell}\n          render={render}\n          onAction={onAction}\n          onCheck={onCheck}\n          // todo 先注释 quickEditEnabled={item.depth === 1}\n          onQuickChange={onQuickChange}\n          {...rowProps}\n        />\n      ];\n\n      if (footable && footableColumns.length) {\n        if (item.depth === 1) {\n          doms.push(\n            <TableRow\n              {...itemProps}\n              classnames={cx}\n              checkOnItemClick={checkOnItemClick}\n              key={`foot-${item.id}`}\n              itemIndex={rowIndex}\n              item={item}\n              itemClassName={cx(\n                rowClassNameExpr\n                  ? filter(rowClassNameExpr, item.data)\n                  : rowClassName\n              )}\n              columns={footableColumns}\n              renderCell={renderCell}\n              render={render}\n              onAction={onAction}\n              onCheck={onCheck}\n              footableMode\n              footableColSpan={columns.length}\n              onQuickChange={onQuickChange}\n              {...rowProps}\n            />\n          );\n        }\n      } else if (item.children.length) {\n        // 嵌套表格\n        doms.push(\n          ...this.renderRows(item.children, columns, {\n            ...rowProps,\n            parent: item\n          })\n        );\n      }\n      return doms;\n    });\n  }\n\n  render() {\n    const {\n      placeholder,\n      classnames: cx,\n      render,\n      className,\n      columns,\n      columnsGroup,\n      onMouseMove,\n      onScroll,\n      tableRef,\n      rows,\n      renderHeadCell\n    } = this.props;\n\n    const tableClassName = cx('Table-table', this.props.tableClassName);\n    const hideHeader = columns.every(column => !column.label);\n\n    return (\n      <div\n        onMouseMove={onMouseMove}\n        className={cx('Table-content', className)}\n        onScroll={onScroll}\n      >\n        <table ref={tableRef} className={tableClassName}>\n          <thead>\n            {columnsGroup.length ? (\n              <tr>\n                {columnsGroup.map((item, index) => (\n                  <th\n                    key={index}\n                    data-index={item.index}\n                    colSpan={item.colSpan}\n                  >\n                    {item.label ? render('tpl', item.label) : null}\n                  </th>\n                ))}\n              </tr>\n            ) : null}\n            <tr className={hideHeader ? 'fake-hide' : ''}>\n              {columns.map(column =>\n                renderHeadCell(column, {\n                  'data-index': column.index,\n                  'key': column.index\n                })\n              )}\n            </tr>\n          </thead>\n          <tbody>\n            {rows.length ? (\n              this.renderRows(rows, columns)\n            ) : (\n              <tr className={cx('Table-placeholder')}>\n                <td colSpan={columns.length}>\n                  {render('placeholder', placeholder || '暂无数据')}\n                </td>\n              </tr>\n            )}\n          </tbody>\n        </table>\n      </div>\n    );\n  }\n}\n"
    ]
}