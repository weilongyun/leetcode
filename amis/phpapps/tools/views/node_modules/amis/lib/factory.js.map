{
    "version": 3,
    "file": "factory.js",
    "sourceRoot": "",
    "sources": [
        "/src/factory.tsx"
    ],
    "names": [],
    "mappings": "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",
    "sourcesContent": [
        "import React from 'react';\nimport qs from 'qs';\nimport {RendererStore, IRendererStore, IIRendererStore} from './store/index';\nimport {getEnv, destroy} from 'mobx-state-tree';\nimport {Location} from 'history';\nimport {wrapFetcher} from './utils/api';\nimport {normalizeLink} from './utils/normalizeLink';\nimport {\n  createObject,\n  extendObject,\n  guid,\n  findIndex,\n  promisify,\n  anyChanged,\n  syncDataFromSuper,\n  isObjectShallowModified,\n  isEmpty,\n  autobind,\n  chainEvents\n} from './utils/helper';\nimport {\n  Api,\n  fetcherResult,\n  Payload,\n  SchemaNode,\n  Schema,\n  Action,\n  RendererData\n} from './types';\nimport {observer} from 'mobx-react';\nimport getExprProperties from './utils/filter-schema';\nimport hoistNonReactStatic from 'hoist-non-react-statics';\nimport omit from 'lodash/omit';\nimport difference from 'lodash/difference';\nimport isPlainObject from 'lodash/isPlainObject';\nimport Scoped from './Scoped';\nimport {\n  getTheme,\n  ThemeInstance,\n  ClassNamesFn,\n  ThemeContext,\n  ThemeProps\n} from './theme';\nimport find from 'lodash/find';\nimport Alert from './components/Alert2';\nimport {toast} from './components/Toast';\nimport {alert, confirm} from './components/Alert';\nimport {LazyComponent} from './components';\nimport ImageGallery from './components/ImageGallery';\nimport {\n  TranslateFn,\n  getDefaultLocale,\n  makeTranslator,\n  LocaleContext,\n  LocaleProps\n} from './locale';\nimport {SchemaCollection, SchemaObject, SchemaTpl} from './Schema';\nimport {result} from 'lodash';\n\nexport interface TestFunc {\n  (\n    path: string,\n    schema?: Schema,\n    resolveRenderer?: (\n      path: string,\n      schema?: Schema,\n      props?: any\n    ) => null | RendererConfig\n  ): boolean;\n}\n\nexport interface RendererBasicConfig {\n  test: RegExp | TestFunc;\n  name?: string;\n  storeType?: string;\n  shouldSyncSuperStore?: (\n    store: any,\n    props: any,\n    prevProps: any\n  ) => boolean | undefined;\n  storeExtendsData?: boolean; // 是否需要继承上层数据。\n  weight?: number; // 权重，值越低越优先命中。\n  isolateScope?: boolean;\n  isFormItem?: boolean;\n  // [propName:string]:any;\n}\n\nexport interface RendererEnv {\n  fetcher: (api: Api, data?: any, options?: object) => Promise<Payload>;\n  isCancel: (val: any) => boolean;\n  notify: (\n    type: 'error' | 'success',\n    msg: string,\n    conf?: {\n      closeButton?: boolean;\n      timeout?: number;\n    }\n  ) => void;\n  jumpTo: (to: string, action?: Action, ctx?: object) => void;\n  alert: (msg: string) => void;\n  confirm: (msg: string, title?: string) => Promise<boolean>;\n  updateLocation: (location: any, replace?: boolean) => void;\n  isCurrentUrl: (link: string) => boolean;\n  rendererResolver?: (\n    path: string,\n    schema: Schema,\n    props: any\n  ) => null | RendererConfig;\n  copy?: (contents: string) => void;\n  getModalContainer?: () => HTMLElement;\n  theme: ThemeInstance;\n  affixOffsetTop: number;\n  affixOffsetBottom: number;\n  richTextToken: string;\n  loadRenderer: (\n    schema: Schema,\n    path: string,\n    reRender: Function\n  ) => Promise<React.ReactType> | React.ReactType | JSX.Element | void;\n  [propName: string]: any;\n}\n\nexport interface RendererProps extends ThemeProps, LocaleProps {\n  render: (region: string, node: SchemaNode, props?: any) => JSX.Element;\n  env: RendererEnv;\n  $path: string; // 当前组件所在的层级信息\n  store?: IIRendererStore;\n  syncSuperStore?: boolean;\n  data: {\n    [propName: string]: any;\n  };\n  defaultData?: object;\n  className?: string;\n  [propName: string]: any;\n}\n\nexport interface renderChildProps extends Partial<RendererProps> {\n  env: RendererEnv;\n}\n\nexport type RendererComponent = React.ComponentType<RendererProps> & {\n  propsList?: Array<any>;\n};\n\nexport interface RendererConfig extends RendererBasicConfig {\n  component: RendererComponent;\n  Renderer?: RendererComponent; // 原始组件\n}\n\nexport interface RenderSchemaFilter {\n  (schema: Schema, renderer: RendererConfig, props?: object): Schema;\n}\n\nexport interface RootRenderProps {\n  location?: Location;\n  theme?: string;\n  [propName: string]: any;\n}\n\nexport interface RenderOptions {\n  session?: string;\n  fetcher?: (config: fetcherConfig) => Promise<fetcherResult>;\n  isCancel?: (value: any) => boolean;\n  notify?: (type: 'error' | 'success', msg: string) => void;\n  jumpTo?: (to: string, action?: Action, ctx?: object) => void;\n  alert?: (msg: string) => void;\n  confirm?: (msg: string, title?: string) => boolean | Promise<boolean>;\n  rendererResolver?: (\n    path: string,\n    schema: Schema,\n    props: any\n  ) => null | RendererConfig;\n  copy?: (contents: string) => void;\n  getModalContainer?: () => HTMLElement;\n  loadRenderer?: (\n    schema: Schema,\n    path: string,\n    reRender: Function\n  ) => Promise<React.ReactType> | React.ReactType | JSX.Element | void;\n  affixOffsetTop?: number;\n  affixOffsetBottom?: number;\n  richTextToken?: string;\n  [propName: string]: any;\n}\n\nexport interface fetcherConfig {\n  url: string;\n  method?: 'get' | 'post' | 'put' | 'patch' | 'delete';\n  data?: any;\n  config?: any;\n}\n\nexport type ReactElement = React.ReactNode[] | JSX.Element | null | false;\n\nconst renderers: Array<RendererConfig> = [];\nconst rendererNames: Array<string> = [];\nconst schemaFilters: Array<RenderSchemaFilter> = [];\nlet anonymousIndex = 1;\n\nexport function addSchemaFilter(fn: RenderSchemaFilter) {\n  schemaFilters.push(fn);\n}\n\nexport function filterSchema(\n  schema: Schema,\n  render: RendererConfig,\n  props?: any\n) {\n  return schemaFilters.reduce(\n    (schema, filter) => filter(schema, render, props),\n    schema\n  ) as Schema;\n}\n\nexport function Renderer(config: RendererBasicConfig) {\n  return function <T extends RendererComponent>(component: T): T {\n    const renderer = registerRenderer({\n      ...config,\n      component: component\n    });\n    return renderer.component as T;\n  };\n}\n\nexport function registerRenderer(config: RendererConfig): RendererConfig {\n  if (!config.test) {\n    throw new TypeError('config.test is required');\n  } else if (!config.component) {\n    throw new TypeError('config.component is required');\n  }\n\n  config.weight = config.weight || 0;\n  config.Renderer = config.component;\n  config.name = config.name || `anonymous-${anonymousIndex++}`;\n\n  if (~rendererNames.indexOf(config.name)) {\n    throw new Error(\n      `The renderer with name \"${config.name}\" has already exists, please try another name!`\n    );\n  }\n\n  if (config.storeType && config.component) {\n    config.component = HocStoreFactory({\n      storeType: config.storeType,\n      extendsData: config.storeExtendsData,\n      shouldSyncSuperStore: config.shouldSyncSuperStore\n    })(observer(config.component));\n  }\n\n  if (config.isolateScope) {\n    config.component = Scoped(config.component);\n  }\n\n  const idx = findIndex(\n    renderers,\n    item => (config.weight as number) < item.weight\n  );\n  ~idx ? renderers.splice(idx, 0, config) : renderers.push(config);\n  rendererNames.push(config.name);\n  return config;\n}\n\nexport function unRegisterRenderer(config: RendererConfig | string) {\n  let idx =\n    typeof config === 'string'\n      ? findIndex(renderers, item => item.name === config)\n      : renderers.indexOf(config);\n  ~idx && renderers.splice(idx, 1);\n\n  let idx2 =\n    typeof config === 'string'\n      ? findIndex(rendererNames, item => item === config)\n      : rendererNames.indexOf(config.name || '');\n  ~idx2 && rendererNames.splice(idx2, 1);\n\n  // 清空渲染器定位缓存\n  cache = {};\n}\n\nexport function renderChildren(\n  prefix: string,\n  node: SchemaNode,\n  props: renderChildProps\n): ReactElement {\n  if (Array.isArray(node)) {\n    return node.map((node, index) =>\n      renderChild(`${prefix}/${index}`, node, {\n        ...props,\n        key: `${props.key ? `${props.key}-` : ''}${index}`\n      })\n    );\n  }\n\n  return renderChild(prefix, node, props);\n}\n\nexport function renderChild(\n  prefix: string,\n  node: SchemaNode,\n  props: renderChildProps\n): ReactElement {\n  if (Array.isArray(node)) {\n    return renderChildren(prefix, node, props);\n  }\n\n  const typeofnode = typeof node;\n  let schema: Schema =\n    typeofnode === 'string' || typeofnode === 'number'\n      ? {type: 'tpl', tpl: String(node)}\n      : (node as Schema);\n  const detectData =\n    schema.detectField === '&' ? props : props[schema.detectField || 'data'];\n  const exprProps = detectData\n    ? getExprProperties(schema, detectData, undefined, props)\n    : null;\n\n  if (\n    exprProps &&\n    (exprProps.hidden ||\n      exprProps.visible === false ||\n      schema.hidden ||\n      schema.visible === false ||\n      props.hidden ||\n      props.visible === false)\n  ) {\n    return null;\n  }\n\n  const transform = props.propsTransform;\n\n  if (transform) {\n    // @ts-ignore\n    delete props.propsTransform;\n    props = transform(props);\n  }\n\n  return (\n    <SchemaRenderer\n      {...props}\n      {...exprProps}\n      schema={schema}\n      $path={`${prefix ? `${prefix}/` : ''}${(schema && schema.type) || ''}`}\n    />\n  );\n}\n\nexport interface RootRendererProps {\n  schema: SchemaNode;\n  rootStore: IRendererStore;\n  env: RendererEnv;\n  theme: string;\n  pathPrefix?: string;\n  locale?: string;\n  translate?: TranslateFn;\n  [propName: string]: any;\n}\n\nexport const RootStoreContext = React.createContext<IRendererStore>(\n  undefined as any\n);\n\nexport class RootRenderer extends React.Component<RootRendererProps> {\n  state = {\n    error: null,\n    errorInfo: null\n  };\n\n  componentDidCatch(error: any, errorInfo: any) {\n    console.error(error);\n    this.setState({\n      error: error,\n      errorInfo: errorInfo\n    });\n  }\n\n  @autobind\n  resolveDefinitions(name: string) {\n    const definitions = (this.props.schema as Schema).definitions;\n    if (!name || isEmpty(definitions)) {\n      return {};\n    }\n    return definitions && definitions[name];\n  }\n\n  render() {\n    const {error, errorInfo} = this.state;\n    if (errorInfo) {\n      return errorRenderer(error, errorInfo);\n    }\n    const {\n      schema,\n      rootStore,\n      env,\n      pathPrefix,\n      location,\n      data,\n      locale,\n      translate,\n      ...rest\n    } = this.props;\n\n    const theme = env.theme;\n    const query =\n      (location && location.query) ||\n      (location && location.search && qs.parse(location.search.substring(1))) ||\n      (window.location.search && qs.parse(window.location.search.substring(1)));\n\n    const finalData = query\n      ? createObject(\n          {\n            ...(data && data.__super ? data.__super : null),\n            ...query,\n            __query: query\n          },\n          data\n        )\n      : data;\n\n    return (\n      <RootStoreContext.Provider value={rootStore}>\n        <ThemeContext.Provider value={this.props.theme || 'default'}>\n          <LocaleContext.Provider value={this.props.locale!}>\n            <ImageGallery modalContainer={env.getModalContainer}>\n              {\n                renderChild(\n                  pathPrefix || '',\n                  isPlainObject(schema)\n                    ? {\n                        type: 'page',\n                        ...(schema as any)\n                      }\n                    : schema,\n                  {\n                    ...rest,\n                    resolveDefinitions: this.resolveDefinitions,\n                    location: location,\n                    data: finalData,\n                    env,\n                    classnames: theme.classnames,\n                    classPrefix: theme.classPrefix,\n                    locale,\n                    translate\n                  }\n                ) as JSX.Element\n              }\n            </ImageGallery>\n          </LocaleContext.Provider>\n        </ThemeContext.Provider>\n      </RootStoreContext.Provider>\n    );\n  }\n}\n\nexport const ScopedRootRenderer = Scoped(RootRenderer);\n\ninterface SchemaRendererProps extends Partial<RendererProps> {\n  schema: Schema;\n  $path: string;\n  env: RendererEnv;\n}\n\nconst defaultOmitList = [\n  'type',\n  'name',\n  '$ref',\n  'className',\n  'data',\n  'children',\n  'ref',\n  'visible',\n  'visibleOn',\n  'hidden',\n  'hiddenOn',\n  'disabled',\n  'disabledOn',\n  'component',\n  'detectField',\n  'required',\n  'requiredOn',\n  'syncSuperStore'\n];\n\nclass SchemaRenderer extends React.Component<SchemaRendererProps, any> {\n  static displayName: string = 'Renderer';\n\n  renderer: RendererConfig | null;\n  ref: any;\n  schema: any;\n  path: string;\n\n  constructor(props: SchemaRendererProps) {\n    super(props);\n    this.refFn = this.refFn.bind(this);\n    this.renderChild = this.renderChild.bind(this);\n    this.reRender = this.reRender.bind(this);\n  }\n\n  componentWillMount() {\n    this.resolveRenderer(this.props);\n  }\n\n  componentWillReceiveProps(nextProps: SchemaRendererProps) {\n    const props = this.props;\n\n    if (\n      props.schema.type !== nextProps.schema.type ||\n      props.schema.$$id !== nextProps.schema.$$id\n    ) {\n      this.resolveRenderer(nextProps);\n    }\n  }\n\n  // 限制：只有 schema 除外的 props 变化，或者 schema 里面的某个成员值发生变化才更新。\n  shouldComponentUpdate(nextProps: SchemaRendererProps) {\n    const props = this.props;\n    const list: Array<string> = difference(Object.keys(nextProps), [\n      'schema',\n      'scope'\n    ]);\n\n    if (\n      difference(Object.keys(props), ['schema', 'scope']).length !==\n        list.length ||\n      anyChanged(list, this.props, nextProps)\n    ) {\n      return true;\n    } else {\n      const list: Array<string> = Object.keys(nextProps.schema);\n\n      if (\n        Object.keys(props.schema).length !== list.length ||\n        anyChanged(list, props.schema, nextProps.schema)\n      ) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  resolveRenderer(props: SchemaRendererProps, skipResolve = false): any {\n    let schema = props.schema;\n    let path = props.$path;\n\n    if (schema.$ref) {\n      schema = {\n        ...props.resolveDefinitions(schema.$ref),\n        ...schema\n      };\n\n      path = path.replace(/(?!.*\\/).*/, schema.type);\n    }\n\n    if (!skipResolve) {\n      const rendererResolver = props.env.rendererResolver || resolveRenderer;\n      this.renderer = rendererResolver(path, schema, props);\n    }\n\n    return {path, schema};\n  }\n\n  getWrappedInstance() {\n    return this.ref;\n  }\n\n  refFn(ref: any) {\n    this.ref = ref;\n  }\n\n  renderChild(\n    region: string,\n    node?: SchemaNode,\n    subProps: {\n      data?: object;\n      [propName: string]: any;\n    } = {}\n  ) {\n    let {schema, $path, env, ...rest} = this.props;\n\n    if (schema.$ref) {\n      const result = this.resolveRenderer(this.props, true);\n      schema = result.schema;\n      $path = result.path;\n    }\n\n    const omitList = defaultOmitList.concat();\n    if (this.renderer) {\n      const Component = this.renderer.component;\n      Component.propsList &&\n        omitList.push.apply(omitList, Component.propsList as Array<string>);\n    }\n\n    return renderChild(`${$path}${region ? `/${region}` : ''}`, node || '', {\n      ...omit(rest, omitList),\n      ...subProps,\n      data: subProps.data || rest.data,\n      env: env\n    });\n  }\n\n  reRender() {\n    this.resolveRenderer(this.props);\n    this.forceUpdate();\n  }\n\n  render(): JSX.Element | null {\n    let {$path, schema, ...rest} = this.props;\n\n    if (schema.$ref) {\n      const result = this.resolveRenderer(this.props, true);\n      schema = result.schema;\n      $path = result.path;\n    }\n\n    const theme = this.props.env.theme;\n\n    if (Array.isArray(schema)) {\n      return renderChildren($path, schema as any, rest) as JSX.Element;\n    } else if (schema.children) {\n      return React.isValidElement(schema.children)\n        ? schema.children\n        : (schema.children as Function)({\n            ...rest,\n            $path: $path,\n            render: this.renderChild,\n            forwardedRef: this.refFn\n          });\n    } else if (typeof schema.component === 'function') {\n      const isSFC = !(schema.component.prototype instanceof React.Component);\n      return React.createElement(schema.component as any, {\n        ...rest,\n        ...schema,\n        $path: $path,\n        ref: isSFC ? undefined : this.refFn,\n        forwardedRef: isSFC ? this.refFn : undefined,\n        render: this.renderChild\n      });\n    } else if (!this.renderer) {\n      return (\n        <LazyComponent\n          {...rest}\n          getComponent={async () => {\n            const result = await rest.env.loadRenderer(\n              schema,\n              $path,\n              this.reRender\n            );\n            if (result && typeof result === 'function') {\n              return result;\n            } else if (result && React.isValidElement(result)) {\n              return () => result;\n            }\n\n            this.reRender();\n            return () => loadRenderer(schema, $path);\n          }}\n          $path={$path}\n          retry={this.reRender}\n        />\n      );\n    }\n\n    const renderer = this.renderer as RendererConfig;\n    schema = filterSchema(schema, renderer, rest);\n    const {data: defaultData, ...restSchema} = schema;\n    const Component = renderer.component;\n\n    return (\n      <Component\n        {...theme.getRendererConfig(renderer.name)}\n        {...restSchema}\n        {...chainEvents(rest, restSchema)}\n        defaultData={defaultData}\n        $path={$path}\n        ref={this.refFn}\n        render={this.renderChild}\n      />\n    );\n  }\n}\n\nexport function HocStoreFactory(renderer: {\n  storeType: string;\n  extendsData?: boolean;\n  shouldSyncSuperStore?: (\n    store: any,\n    props: any,\n    prevProps: any\n  ) => boolean | undefined;\n}): any {\n  return function <T extends React.ComponentType<RendererProps>>(Component: T) {\n    type Props = Omit<\n      RendererProps,\n      'store' | 'data' | 'dataUpdatedAt' | 'scope'\n    > & {\n      store?: IIRendererStore;\n      data?: RendererData;\n      scope?: RendererData;\n    };\n\n    @observer\n    class StoreFactory extends React.Component<Props> {\n      static displayName = `WithStore(${\n        Component.displayName || Component.name\n      })`;\n      static ComposedComponent = Component;\n      static contextType = RootStoreContext;\n      store: IIRendererStore;\n      context!: React.ContextType<typeof RootStoreContext>;\n      ref: any;\n\n      getWrappedInstance() {\n        return this.ref;\n      }\n\n      refFn(ref: any) {\n        this.ref = ref;\n      }\n\n      formatData(data: any): object {\n        if (Array.isArray(data)) {\n          return {\n            items: data\n          };\n        }\n\n        return data as object;\n      }\n\n      componentWillMount() {\n        const rootStore = this.context;\n        this.renderChild = this.renderChild.bind(this);\n        this.refFn = this.refFn.bind(this);\n\n        const store = rootStore.addStore({\n          id: guid(),\n          path: this.props.$path,\n          storeType: renderer.storeType,\n          parentId: this.props.store ? this.props.store.id : ''\n        }) as IIRendererStore;\n        this.store = store;\n\n        if (renderer.extendsData === false) {\n          store.initData(\n            createObject(\n              (this.props.data as any)\n                ? (this.props.data as any).__super\n                : null,\n              {\n                ...this.formatData(this.props.defaultData),\n                ...this.formatData(this.props.data)\n              }\n            )\n          );\n        } else if (\n          this.props.scope ||\n          (this.props.data && (this.props.data as any).__super)\n        ) {\n          if (this.props.store && this.props.data === this.props.store.data) {\n            store.initData(\n              createObject(this.props.store.data, {\n                ...this.formatData(this.props.defaultData)\n              })\n            );\n          } else {\n            store.initData(\n              createObject(\n                (this.props.data as any).__super || this.props.scope,\n                {\n                  ...this.formatData(this.props.defaultData),\n                  ...this.formatData(this.props.data)\n                }\n              )\n            );\n          }\n        } else {\n          store.initData({\n            ...this.formatData(this.props.defaultData),\n            ...this.formatData(this.props.data)\n          });\n        }\n      }\n\n      componentWillReceiveProps(nextProps: RendererProps) {\n        const props = this.props;\n        const store = this.store;\n        const shouldSync = renderer.shouldSyncSuperStore?.(\n          store,\n          nextProps,\n          props\n        );\n\n        if (shouldSync === false) {\n          return;\n        }\n\n        if (renderer.extendsData === false) {\n          if (\n            shouldSync === true ||\n            props.defaultData !== nextProps.defaultData ||\n            isObjectShallowModified(props.data, nextProps.data) ||\n            //\n            // 特殊处理 CRUD。\n            // CRUD 中 toolbar 里面的 data 是空对象，但是 __super 会不一样\n            (nextProps.data &&\n              props.data &&\n              nextProps.data.__super !== props.data.__super)\n          ) {\n            store.initData(\n              extendObject(nextProps.data, {\n                ...(store.hasRemoteData ? store.data : null), // todo 只保留 remote 数据\n                ...this.formatData(nextProps.defaultData),\n                ...this.formatData(nextProps.data)\n              })\n            );\n          }\n        } else if (\n          shouldSync === true ||\n          isObjectShallowModified(props.data, nextProps.data)\n        ) {\n          if (nextProps.store && nextProps.store.data === nextProps.data) {\n            store.initData(\n              createObject(\n                nextProps.store.data,\n                nextProps.syncSuperStore === false\n                  ? {\n                      ...store.data\n                    }\n                  : syncDataFromSuper(\n                      store.data,\n                      nextProps.store.data,\n                      props.scope,\n                      store,\n                      nextProps.syncSuperStore === true\n                    )\n              )\n            );\n          } else if (nextProps.data && (nextProps.data as any).__super) {\n            store.initData(extendObject(nextProps.data));\n          } else {\n            store.initData(createObject(nextProps.scope, nextProps.data));\n          }\n        } else if (\n          (shouldSync === true ||\n            !nextProps.store ||\n            nextProps.data !== nextProps.store.data) &&\n          nextProps.data &&\n          nextProps.data.__super\n        ) {\n          // 这个用法很少，当 data.__super 值发生变化时，更新 store.data\n          (!props.data ||\n            isObjectShallowModified(\n              nextProps.data.__super,\n              props.data.__super,\n              false\n            )) &&\n            // nextProps.data.__super !== props.data.__super) &&\n            store.initData(\n              createObject(nextProps.data.__super, {\n                ...nextProps.data,\n                ...store.data\n              })\n            );\n        } else if (\n          nextProps.scope &&\n          nextProps.data === nextProps.store!.data &&\n          (shouldSync === true || props.data !== nextProps.data)\n        ) {\n          store.initData(\n            createObject(nextProps.scope, {\n              // ...nextProps.data,\n              ...store.data\n            })\n          );\n        }\n      }\n\n      componentWillUnmount() {\n        const rootStore = this.context as IRendererStore;\n        const store = this.store;\n        rootStore.removeStore(store);\n\n        // @ts-ignore\n        delete this.store;\n      }\n\n      renderChild(\n        region: string,\n        node: SchemaNode,\n        subProps: {\n          data?: object;\n          [propName: string]: any;\n        } = {}\n      ) {\n        let {render} = this.props;\n\n        return render(region, node, {\n          data: this.store.data,\n          dataUpdatedAt: this.store.updatedAt,\n          ...subProps,\n          scope: this.store.data,\n          store: this.store\n        });\n      }\n\n      render() {\n        const {detectField, ...rest} = this.props;\n\n        let exprProps: any = {};\n        if (!detectField || detectField === 'data') {\n          exprProps = getExprProperties(rest, this.store.data, undefined, rest);\n\n          if (exprProps.hidden || exprProps.visible === false) {\n            return null;\n          }\n        }\n\n        return (\n          <Component\n            {\n              ...(rest as any) /* todo */\n            }\n            {...exprProps}\n            ref={this.refFn}\n            data={this.store.data}\n            dataUpdatedAt={this.store.updatedAt}\n            store={this.store}\n            scope={this.store.data}\n            render={this.renderChild}\n          />\n        );\n      }\n    }\n    hoistNonReactStatic(StoreFactory, Component);\n\n    return StoreFactory;\n  };\n}\n\nfunction loadRenderer(schema: Schema, path: string) {\n  return (\n    <Alert level=\"danger\">\n      <p>Error: 找不到对应的渲染器</p>\n      <p>Path: {path}</p>\n      <pre>\n        <code>{JSON.stringify(schema, null, 2)}</code>\n      </pre>\n    </Alert>\n  );\n}\n\nfunction errorRenderer(error: any, errorInfo: any) {\n  return (\n    <Alert level=\"danger\">\n      <p>{error && error.toString()}</p>\n      <pre>\n        <code>{errorInfo.componentStack}</code>\n      </pre>\n    </Alert>\n  );\n}\n\nconst defaultOptions: RenderOptions = {\n  session: 'global',\n  affixOffsetTop: 50,\n  affixOffsetBottom: 0,\n  richTextToken: '',\n  loadRenderer,\n  fetcher() {\n    return Promise.reject('fetcher is required');\n  },\n  isCancel() {\n    console.error(\n      'Please implements this. see https://baidu.gitee.io/amis/docs/start/getting-started#%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97'\n    );\n    return false;\n  },\n  updateLocation() {\n    console.error(\n      'Please implements this. see https://baidu.gitee.io/amis/docs/start/getting-started#%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97'\n    );\n  },\n  alert,\n  confirm,\n  notify: (type, msg) =>\n    toast[type]\n      ? toast[type](msg, type === 'error' ? 'Error' : 'Info')\n      : console.warn('[Notify]', type, msg),\n\n  jumpTo: (to: string, action?: any) => {\n    if (to === 'goBack') {\n      return window.history.back();\n    }\n    to = normalizeLink(to);\n    if (action && action.actionType === 'url') {\n      action.blank === false ? (window.location.href = to) : window.open(to);\n      return;\n    }\n    if (/^https?:\\/\\//.test(to)) {\n      window.location.replace(to);\n    } else {\n      location.href = to;\n    }\n  },\n  isCurrentUrl: (to: string) => {\n    const link = normalizeLink(to);\n    const location = window.location;\n    let pathname = link;\n    let search = '';\n    const idx = link.indexOf('?');\n    if (~idx) {\n      pathname = link.substring(0, idx);\n      search = link.substring(idx);\n    }\n    if (search) {\n      if (pathname !== location.pathname || !location.search) {\n        return false;\n      }\n      const query = qs.parse(search.substring(1));\n      const currentQuery = qs.parse(location.search.substring(1));\n      return Object.keys(query).every(key => query[key] === currentQuery[key]);\n    } else if (pathname === location.pathname) {\n      return true;\n    }\n    return false;\n  },\n  copy(contents: string) {\n    console.error('copy contents', contents);\n  },\n  rendererResolver: resolveRenderer\n};\nlet stores: {\n  [propName: string]: IRendererStore;\n} = {};\nexport function render(\n  schema: Schema,\n  props: RootRenderProps = {},\n  options: RenderOptions = {},\n  pathPrefix: string = ''\n): JSX.Element {\n  const locale = props.locale || getDefaultLocale();\n  const translate = props.translate || makeTranslator(locale);\n  let store = stores[options.session || 'global'];\n\n  if (!store) {\n    options = {\n      ...defaultOptions,\n      ...options,\n      fetcher: options.fetcher\n        ? wrapFetcher(options.fetcher)\n        : defaultOptions.fetcher,\n      confirm: options.confirm\n        ? promisify(options.confirm)\n        : defaultOptions.confirm,\n      locale,\n      translate\n    } as any;\n\n    store = RendererStore.create({}, options);\n    stores[options.session || 'global'] = store;\n  }\n\n  (window as any).amisStore = store; // 为了方便 debug.\n  const env = getEnv(store);\n\n  const theme = props.theme || options.theme || 'default';\n  env.theme = getTheme(theme);\n\n  if (props.locale !== undefined) {\n    env.translate = translate;\n    env.locale = locale;\n  }\n\n  return (\n    <ScopedRootRenderer\n      {...props}\n      schema={schema}\n      pathPrefix={pathPrefix}\n      rootStore={store}\n      env={env}\n      theme={theme}\n      locale={locale}\n      translate={translate}\n    />\n  );\n}\n\n// 默认 env 会被缓存，所以新传入的 env 不会替换旧的。\n// 除非先删了旧的，新的才会生效。\nexport function clearStoresCache(\n  sessions: Array<string> | string = Object.keys(stores)\n) {\n  if (!Array.isArray(sessions)) {\n    sessions = [sessions];\n  }\n\n  sessions.forEach(key => {\n    const store = stores[key];\n\n    // @ts-ignore\n    delete stores[key];\n\n    store && destroy(store);\n  });\n}\n\n// 当然也可以直接这样更新。\n// 主要是有时候第一创建的时候并没有准备多少接口，\n// 可以后续补充点，比如 amis 自己实现的，prompt 里面的表单。\nexport function updateEnv(options: Partial<RenderOptions>, session = 'global') {\n  options = {\n    ...options\n  };\n\n  if (options.fetcher) {\n    options.fetcher = wrapFetcher(options.fetcher) as any;\n  }\n\n  if (options.confirm) {\n    options.confirm = promisify(options.confirm);\n  }\n\n  let store = stores[options.session || session];\n  if (!store) {\n    store = RendererStore.create({}, options);\n    stores[options.session || session] = store;\n  } else {\n    const env = getEnv(store);\n    Object.assign(env, options);\n  }\n}\n\nlet cache: {[propName: string]: RendererConfig} = {};\nexport function resolveRenderer(\n  path: string,\n  schema?: Schema,\n  props?: any\n): null | RendererConfig {\n  if (cache[path]) {\n    return cache[path];\n  } else if (path && path.length > 1024) {\n    throw new Error('Path太长是不是死循环了？');\n  }\n\n  let renderer: null | RendererConfig = null;\n\n  renderers.some(item => {\n    let matched = false;\n\n    if (typeof item.test === 'function') {\n      matched = item.test(path, schema, resolveRenderer);\n    } else if (item.test instanceof RegExp) {\n      matched = item.test.test(path);\n    }\n\n    if (matched) {\n      renderer = item;\n    }\n\n    return matched;\n  });\n\n  // 只能缓存纯正则表达式的后者方法中没有用到第二个参数的，因为自定义 test 函数的有可能依赖 schema 的结果\n  if (\n    renderer !== null &&\n    ((renderer as RendererConfig).test instanceof RegExp ||\n      (typeof (renderer as RendererConfig).test === 'function' &&\n        ((renderer as RendererConfig).test as Function).length < 2))\n  ) {\n    cache[path] = renderer;\n  }\n\n  return renderer;\n}\n\nexport function getRenderers() {\n  return renderers.concat();\n}\n\nexport function getRendererByName(name: string) {\n  return find(renderers, item => item.name === name);\n}\n\nexport function withRootStore<\n  T extends React.ComponentType<\n    React.ComponentProps<T> & {\n      rootStore: IRendererStore;\n    }\n  >\n>(ComposedComponent: T) {\n  type OuterProps = JSX.LibraryManagedAttributes<\n    T,\n    Omit<React.ComponentProps<T>, 'rootStore'>\n  >;\n\n  const result = hoistNonReactStatic(\n    class extends React.Component<OuterProps> {\n      static displayName = `WithRootStore(${\n        ComposedComponent.displayName || ComposedComponent.name\n      })`;\n      static contextType = RootStoreContext;\n      static ComposedComponent = ComposedComponent;\n\n      render() {\n        const rootStore = this.context;\n        const injectedProps: {\n          rootStore: IRendererStore;\n        } = {\n          rootStore\n        };\n\n        return (\n          <ComposedComponent\n            {...(this.props as JSX.LibraryManagedAttributes<\n              T,\n              React.ComponentProps<T>\n            >)}\n            {...injectedProps}\n          />\n        );\n      }\n    },\n    ComposedComponent\n  );\n\n  return result as typeof result & {\n    ComposedComponent: T;\n  };\n}\n"
    ]
}