{
    "version": 3,
    "file": "index.js",
    "sourceRoot": "",
    "sources": [
        "/src/components/condition-builder/index.tsx"
    ],
    "names": [],
    "mappings": "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",
    "sourcesContent": [
        "import React from 'react';\nimport {ThemeProps, themeable} from '../../theme';\nimport {LocaleProps, localeable} from '../../locale';\nimport {uncontrollable} from 'uncontrollable';\nimport {Fields, ConditionGroupValue, Funcs} from './types';\nimport ConditionGroup from './Group';\nimport defaultConfig, {Config} from './config';\nimport {\n  autobind,\n  findTreeIndex,\n  spliceTree,\n  getTree,\n  mapTree,\n  guid\n} from '../../utils/helper';\nimport {findDOMNode} from 'react-dom';\nimport animtion from '../../utils/Animation';\n\nexport interface ConditionBuilderProps extends ThemeProps, LocaleProps {\n  fields: Fields;\n  funcs?: Funcs;\n  showNot?: boolean;\n  value?: ConditionGroupValue;\n  onChange: (value: ConditionGroupValue) => void;\n  config?: Config;\n}\n\nexport class QueryBuilder extends React.Component<ConditionBuilderProps> {\n  config = {...defaultConfig, ...this.props.config};\n\n  dragTarget?: HTMLElement;\n  // dragNextSibling: Element | null;\n  ghost?: HTMLElement;\n  host: HTMLElement;\n  lastX: number;\n  lastY: number;\n  lastMoveAt: number = 0;\n\n  @autobind\n  handleDragStart(e: React.DragEvent) {\n    const target = e.currentTarget;\n    const item = target.closest('[data-id]') as HTMLElement;\n    this.dragTarget = item;\n    // this.dragNextSibling = item.nextElementSibling;\n    this.host = item.closest('[data-group-id]') as HTMLElement;\n\n    const ghost = item.cloneNode(true) as HTMLElement;\n    ghost.classList.add('is-ghost');\n    this.ghost = ghost;\n\n    e.dataTransfer.setDragImage(item.firstChild as HTMLElement, 0, 0);\n\n    target.addEventListener('dragend', this.handleDragEnd);\n    document.body.addEventListener('dragover', this.handleDragOver);\n    document.body.addEventListener('drop', this.handleDragDrop);\n    this.lastX = e.clientX;\n    this.lastY = e.clientY;\n\n    // 应该是 chrome 的一个bug，如果你马上修改，会马上执行 dragend\n    setTimeout(() => {\n      item.classList.add('is-dragging');\n      // item.parentElement!.insertBefore(\n      //   item,\n      //   item.parentElement!.firstElementChild\n      // ); // 挪到第一个，主要是因为样式问题。\n    }, 5);\n  }\n\n  @autobind\n  handleDragOver(e: DragEvent) {\n    e.preventDefault();\n    const item = (e.target as HTMLElement).closest('[data-id]') as HTMLElement;\n\n    const dx = e.clientX - this.lastX;\n    const dy = e.clientY - this.lastY;\n    const d = Math.max(Math.abs(dx), Math.abs(dy));\n    const now = Date.now();\n\n    // 没移动还是不要处理，免得晃动个不停。\n    if (d < 5) {\n      if (this.lastMoveAt === 0) {\n      } else if (now - this.lastMoveAt > 500) {\n        const host = (e.target as HTMLElement).closest(\n          '[data-group-id]'\n        ) as HTMLElement;\n\n        if (host) {\n          this.host = host;\n          this.lastMoveAt = now;\n          this.lastX = 0;\n          this.lastY = 0;\n          this.handleDragOver(e);\n          return;\n        }\n      }\n      return;\n    }\n\n    this.lastMoveAt = now;\n    this.lastX = e.clientX;\n    this.lastY = e.clientY;\n\n    if (\n      !item ||\n      item.classList.contains('is-ghost') ||\n      item.closest('[data-group-id]') !== this.host\n    ) {\n      return;\n    }\n\n    const container = item.parentElement!;\n    const children = [].slice.apply(container!.children);\n\n    const idx = children.indexOf(item);\n\n    if (this.ghost!.parentElement !== container) {\n      container.appendChild(this.ghost!);\n    }\n\n    const rect = item.getBoundingClientRect();\n    const isAfter = dy > 0 && e.clientY > rect.top + rect.height / 2;\n    const gIdx = isAfter ? idx : idx - 1;\n    const cgIdx = children.indexOf(this.ghost);\n\n    if (gIdx !== cgIdx) {\n      animtion.capture(container);\n\n      if (gIdx === children.length - 1) {\n        container.appendChild(this.ghost!);\n      } else {\n        container.insertBefore(this.ghost!, children[gIdx + 1]);\n      }\n\n      animtion.animateAll();\n    }\n  }\n\n  @autobind\n  handleDragDrop() {\n    const onChange = this.props.onChange;\n    const fromId = this.dragTarget!.getAttribute('data-id')!;\n    const toId = this.host.getAttribute('data-group-id')!;\n    const children = [].slice.call(this.ghost!.parentElement!.children);\n    const idx = children.indexOf(this.dragTarget);\n\n    if (~idx) {\n      children.splice(idx, 1);\n    }\n\n    const toIndex = children.indexOf(this.ghost);\n    let value = this.props.value!;\n\n    const indexes = findTreeIndex([value], item => item.id === fromId);\n\n    if (indexes) {\n      const origin = getTree([value], indexes.concat())!;\n      [value] = spliceTree([value]!, indexes, 1);\n\n      const indexes2 = findTreeIndex([value], item => item.id === toId);\n\n      if (indexes2) {\n        [value] = spliceTree([value]!, indexes2.concat(toIndex), 0, origin);\n        onChange(value);\n      }\n    }\n  }\n\n  @autobind\n  handleDragEnd(e: Event) {\n    const target = e.target as HTMLElement;\n\n    target.removeEventListener('dragend', this.handleDragEnd);\n    document.body.removeEventListener('dragover', this.handleDragOver);\n    document.body.removeEventListener('drop', this.handleDragDrop);\n\n    this.dragTarget!.classList.remove('is-dragging');\n    // if (this.dragNextSibling) {\n    //   this.dragTarget.parentElement!.insertBefore(\n    //     this.dragTarget,\n    //     this.dragNextSibling\n    //   );\n    // } else {\n    //   this.dragTarget.parentElement!.appendChild(this.dragTarget);\n    // }\n    delete this.dragTarget;\n    // delete this.dragNextSibling;\n    this.ghost!.parentElement?.removeChild(this.ghost!);\n    delete this.ghost;\n  }\n\n  render() {\n    const {\n      classnames: cx,\n      fields,\n      funcs,\n      onChange,\n      value,\n      showNot\n    } = this.props;\n\n    const normalizedValue = Array.isArray(value?.children)\n      ? {\n          ...value,\n          children: mapTree(value!.children, (value: any) => {\n            if (value.id) {\n              return value;\n            }\n\n            return {\n              ...value,\n              id: guid()\n            };\n          })\n        }\n      : value;\n\n    return (\n      <ConditionGroup\n        config={this.config}\n        funcs={funcs || this.config.funcs}\n        fields={fields || this.config.fields}\n        value={normalizedValue as any}\n        onChange={onChange}\n        classnames={cx}\n        removeable={false}\n        onDragStart={this.handleDragStart}\n        showNot={showNot}\n      />\n    );\n  }\n}\n\nexport default themeable(\n  localeable(\n    uncontrollable(QueryBuilder, {\n      value: 'onChange'\n    })\n  )\n);\n"
    ]
}