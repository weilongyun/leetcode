{
    "version": 3,
    "file": "combo.js",
    "sourceRoot": "",
    "sources": [
        "/src/store/combo.ts"
    ],
    "names": [],
    "mappings": "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",
    "sourcesContent": [
        "import {types, SnapshotIn, isAlive, onAction} from 'mobx-state-tree';\nimport {iRendererStore} from './iRenderer';\nimport {FormItemStore} from './formItem';\nimport {FormStore, IFormStore, IFormItemStore} from './form';\nimport {getStoreById} from './index';\n\nexport const UniqueGroup = types\n  .model('UniqueGroup', {\n    name: types.identifier,\n    itemsRef: types.array(types.string)\n  })\n  .views(self => ({\n    get items() {\n      return self.itemsRef.map(\n        id => (getStoreById(id) as any) as IFormItemStore\n      );\n    }\n  }))\n  .actions(self => ({\n    removeItem(item: IFormItemStore) {\n      self.itemsRef.replace(self.itemsRef.filter(id => id !== item.id));\n    },\n\n    addItem(item: IFormItemStore) {\n      self.itemsRef.push(item.id);\n    }\n  }));\n\nexport type IUniqueGroup = typeof UniqueGroup.Type;\n\nexport const ComboStore = iRendererStore\n  .named('ComboStore')\n  .props({\n    uniques: types.map(UniqueGroup),\n    formsRef: types.optional(types.array(types.string), []),\n    minLength: 0,\n    maxLength: 0,\n    length: 0,\n    activeKey: 0\n  })\n  .views(self => ({\n    get forms() {\n      return self.formsRef.map(item => getStoreById(item) as IFormStore);\n    },\n    get addable() {\n      if (self.maxLength && self.length >= self.maxLength) {\n        return false;\n      }\n\n      if (self.uniques.size) {\n        let isFull = false;\n        self.uniques.forEach(item => {\n          if (isFull || !item.items.length) {\n            return;\n          }\n\n          let total = item.items[0].options.length;\n          let current = item.items.reduce((total, item) => {\n            return total + item.selectedOptions.length;\n          }, 0);\n\n          isFull = total && current >= total ? true : false;\n        });\n\n        if (isFull) {\n          return false;\n        }\n      }\n\n      return true;\n    },\n\n    get removable() {\n      if (self.minLength && self.minLength >= self.length) {\n        return false;\n      }\n\n      return true;\n    }\n  }))\n  .actions(self => {\n    function config(setting: {\n      minLength?: number;\n      maxLength?: number;\n      length?: number;\n    }) {\n      typeof setting.minLength !== 'undefined' &&\n        (self.minLength = parseInt(setting.minLength as any, 10));\n      typeof setting.maxLength !== 'undefined' &&\n        (self.maxLength = parseInt(setting.maxLength as any, 10));\n      typeof setting.length !== 'undefined' && (self.length = setting.length);\n    }\n\n    function bindUniuqueItem(item: IFormItemStore) {\n      if (!self.uniques.has(item.name)) {\n        self.uniques.put({\n          name: item.name\n        });\n      }\n      let group: IUniqueGroup = self.uniques.get(item.name) as IUniqueGroup;\n      group.addItem(item);\n    }\n\n    function unBindUniuqueItem(item: IFormItemStore) {\n      let group: IUniqueGroup = self.uniques.get(item.name) as IUniqueGroup;\n      group.removeItem(item);\n      if (!group.items.length) {\n        self.uniques.delete(item.name);\n      }\n    }\n\n    function addForm(form: IFormStore) {\n      self.formsRef.push(form.id);\n    }\n\n    function onChildStoreDispose(child: IFormStore) {\n      if (child.storeType === FormStore.name) {\n        const idx = self.formsRef.indexOf(child.id);\n        if (~idx) {\n          self.formsRef.splice(idx, 1);\n          child.items.forEach(item => {\n            if (item.unique) {\n              unBindUniuqueItem(item);\n            }\n          });\n\n          self.forms.forEach(item =>\n            item.items.forEach(item => item.unique && item.syncOptions())\n          );\n        }\n      }\n      self.removeChildId(child.id);\n    }\n\n    function setActiveKey(key: number) {\n      self.activeKey = key;\n    }\n\n    return {\n      config,\n      setActiveKey,\n      bindUniuqueItem,\n      unBindUniuqueItem,\n      addForm,\n      onChildStoreDispose\n    };\n  });\n\nexport type IComboStore = typeof ComboStore.Type;\nexport type SComboStore = SnapshotIn<typeof ComboStore>;\n"
    ]
}